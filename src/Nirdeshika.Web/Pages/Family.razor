@page "/families/{Id:int}"

<div id="add-family-member-fab">
    <MudFab Color="Color.Error" StartIcon="@Icons.Material.Filled.Add" @onclick="OpenAddFamilyMemberDialogAsync" />
</div>

@if (_isLoading)
{
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
}
else
{
    if (_family is null)
    {

    }
    else
    {
        <MudPaper Elevation="4" Class="pa-6 rounded-lg">
            <!-- Head of Family -->
            <MudGrid>
                <MudItem xs="12" sm="4" Class="d-flex justify-center align-center">
                    <MudAvatar Size="Size.Large"
                               Color="Color.Secondary">
                        @_family.Head?[..1].ToUpper()
                    </MudAvatar>
                </MudItem>
                <MudItem xs="12" sm="8">
                    <MudText Typo="Typo.h4">@_family.Head</MudText>
                    <MudText Typo="Typo.subtitle1">Family ID: @_family.Id</MudText>
                </MudItem>
            </MudGrid>

            <MudDivider Class="my-4" />

            <!-- Address -->
            <MudText Typo="Typo.h6" GutterBottom="true"><MudIcon Icon="@Icons.Material.Filled.Home" /> Address</MudText>
            <MudText>@_family.Address?.Area</MudText>

            <MudDivider Class="my-4" />

            <MudItem sm="12">
                <MudDataGrid Items="@_familyMembers" Loading="@_loadingFamilyMembers" Striped="true" Bordered="true" Hover="true">
                    <ToolBarContent>
                        <MudStack Row>
                            <MudIcon Icon="@Icons.Material.Rounded.Group" />
                            <MudText Typo="Typo.h6">Family Members</MudText>
                        </MudStack>
                    </ToolBarContent>
                    <Columns>
                        <PropertyColumn Title="" Property="x => x.Gender">
                            <CellTemplate>
                                @if (context.Item!.Gender == 'M')
                                {
                                    <MudIcon Icon="@Icons.Material.Rounded.Male" Color="Color.Info" />
                                }
                                else
                                {
                                    <MudIcon Icon="@Icons.Material.Rounded.Female" Color="Color.Secondary" />
                                }
                            </CellTemplate>
                        </PropertyColumn>
                        <PropertyColumn Property="x => x.Name" />
                        <PropertyColumn Title="Relation type" Property="x => x.RelationTypeId">
                            <CellTemplate>
                                @_relationTypes.FirstOrDefault(rt => rt.Id == context.Item!.RelationTypeId)?.Type
                            </CellTemplate>
                        </PropertyColumn>
                        <PropertyColumn Property="x => x.Relative" />
                        <PropertyColumn Title="Date of birth" Property="x => x.DateOfBirth" Format="dd-MM-yyyy" />
                        
                        <PropertyColumn Title="Mobile number" Property="x => x.MobileNumber" />
                    </Columns>
                </MudDataGrid>
            </MudItem>

            <!-- Footer -->
            <MudCardActions Class="mt-6 justify-end">
                <MudButton StartIcon="@Icons.Material.Filled.ArrowBack"
                           Variant="Variant.Filled"
                           Color="@Color.Error"
                           OnClick="@(() => NavigationManager.NavigateTo("/families"))">
                    Back to List
                </MudButton>
            </MudCardActions>
        </MudPaper>
    }
}